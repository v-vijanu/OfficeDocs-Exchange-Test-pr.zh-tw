---
title: 'Exchange 2013 虛擬化: Exchange 2013 Help'
TOCTitle: Exchange 2013 虛擬化
ms:assetid: 36184b2f-4cd9-48f8-b100-867fe4c6b579
ms:mtpsurl: https://technet.microsoft.com/zh-tw/library/JJ619301(v=EXCHG.150)
ms:contentKeyID: 50472962
ms.date: 01/27/2018
mtps_version: v=EXCHG.150
ms.translationtype: HT
---

# Exchange 2013 虛擬化

 

_**適用版本：**Exchange Server 2013_

_**上次修改主題的時間：**2017-08-08_

您可以在虛擬環境中部署 Microsoft Exchange Server 2013。本主題可概覽各種支援在硬體虛擬軟體中部署 Exchange 2013 的案例。

**目錄**

硬體虛擬的需求

主機機器儲存需求

Exchange 儲存需求

Exchange 記憶體需求和建議

Exchange 的主機型容錯移轉叢集和遷移

以下為討論 Exchange 虛擬功能時所使用到的術語：

  - **冷開機**   當系統於關機狀態下開機，進入乾淨的作業系統，此動作稱為*冷開機*。在此情況下，不會保留任何的作業系統狀態。

  - **儲存的狀態**   當虛擬機器關機後，Hypervisor 通常能夠儲存虛擬機器的狀態，因此，機器會在重新開機時返回*儲存的狀態*，而不會以冷開機啟動。

  - **計劃性遷移**   系統管理員將虛擬機器由一個 Hypervisor 主機移動到另一個時，此動作稱之為*計劃性遷移*。這項動作可能是一次性遷移，或是系統管理員也可設定按時程自動移動虛擬機器。計劃性遷移的原因，可能是系統發生某些其他事件，而不是硬體或軟體上的故障。重點是，Exchange 虛擬機器運作正常，但因為某些原因而需要移位。此移位作業可透過 Live Migration 或 vMotion 此類的技術來完成。不過，若是因為 Exchange 虛擬機器或部署該虛擬機器的 Hypervisor 主機發生某種故障狀況而需要移位，則不能算是計劃性遷移。

## 硬體虛擬的需求

只有符合下列所有條件時，Microsoft 才會在生產環境的硬體虛擬軟體中支援 Exchange 2013：

  - 硬體虛擬軟體正在執行下列之一：
    
      - 具有 Hyper-V 技術的任何版本的 Windows Server 或 Microsoft Hyper-V Server
    
      - 任何經 [Windows Server Virtualization 驗證方案](https://go.microsoft.com/fwlink/p/?linkid=125375) 驗證過的協力廠商 Hypervisor。 
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/Bb124558.note(EXCHG.150).gif" title="注意事項" alt="注意事項" />注意事項：</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>如果所有支援需求皆符合，將會支援在基礎設施即服務 (IaaS) 提供者上部署 Exchange 2013 。對於佈建虛擬機器提供者，這些需求包括確保 Exchange 虛擬機器所用的 hypervisor 受到完全支援，且 Exchange 所利用的基礎結構符合調整程序期間所決定的效能需求。若已為 Azure Premium Storage 設定 Exchange 資料庫所用的所有儲存區與資料庫交易記錄檔 (包括傳輸資料庫)，則將支援在 Microsoft Azure 虛擬機器上的部署。</td>
    </tr>
    </tbody>
    </table>


  - Exchange 來賓虛擬機器具備以下條件：
    
      - 正在執行 Exchange 2013。
    
      - 部署在 Windows Server 2008 R2 SP1 (或更新版本)、Windows Server 2012 或 Windows Server 2012 R2 上。

針對 Exchange 2013的部署：

  - 所有的 Exchange 2013 伺服器角色在虛擬機器中皆受到支援。

  - Exchange 伺服器虛擬機器 (包含屬於資料庫可用性群組 (DAG) 的 Exchange 信箱虛擬機器)，只要設定為在移動或離線時不會儲存與還原磁碟上的狀態，就可以與主機型容錯移轉叢集與遷移技術結合。當在目標節點啟用虛擬機器時，所有發生在 Hypervisor 層級的容錯移轉活動必須要進行冷開機。所有經計劃的遷移必須要進行關機或冷開機，或者是一種使用像是 Hyper-V Live Migration 技術的線上遷移方式。虛擬機器的 Hypervisor 遷移是由 Hypervisor 廠商所支援；因此，您必須確保您的 Hypervisor 廠商已測試並支援 Exchange 虛擬機器的遷移。Microsoft 即支援這些虛擬機器的 Hyper-V Live Migration。

  - 實體主機機器上只可以部署管理軟體 (例如，防病毒軟體、備份軟體或虛擬機器管理軟體)。主機機器上不應該安裝其他伺服器應用程式 (例如，Exchange、SQL Server、Active Directory 或 SAP)。主機機器應該專用於執行來賓虛擬機器。

  - 部分 Hypervisor 包含用來取得虛擬機器快照集的功能。虛擬機器快照集會擷取執行中虛擬機器的狀態。此功能可讓您取得虛擬機器的多個快照集，然後將快照集套用至虛擬機器，以將虛擬機器還原為任何先前狀態。不過，應用程式無法感知虛擬機器快照集，而且使用快照集會讓維護狀態資料的伺服器應用程式 (如 Exchange) 產生未知及意外的後果。因此，不支援產生 Exchange 來賓虛擬機器的虛擬機器快照集。

  - 許多硬體虛擬產品都可讓您指定應配置給每部來賓虛擬機器的虛擬處理器數目。位於來賓虛擬機器的虛擬處理器會共用實體系統中的固定實體處理器數目。Exchange 支援的虛擬處理器與實體處理器比率不可大於 2:1，雖然我們建議使用 1:1 的比率。例如，使用四核心處理器的雙處理器系統在主機系統中共包含 8 個實體處理器。在具有此組態的系統上，配置給所有來賓虛擬機器的合併虛擬處理器總數目不可超過 16 個。

  - 計算主機機器所需要的虛擬處理器總數時，您也必須考慮 I/O 和作業系統需求。大部分情況下，在主控 Exchange 虛擬機器的系統中，其主機作業系統需要的對等虛擬處理器數目是 2。而在計算實體核心與虛擬處理器的整體比例時，應該將此值做為主機作業系統虛擬處理器的基準線。如果主機作業系統的效能監視指出您耗用的處理器使用率高於 2 個處理器的對等值，則應該據此減少指派給來賓虛擬機器的虛擬處理器計數，並確認虛擬處理器與實體核心的整體比例不大於 2:1。

  - Exchange 來賓機器的作業系統使用的磁碟大小必須至少為 15 GB 加上配置給來賓機器的虛擬記憶體大小。此需求需要計入作業系統和分頁檔案磁碟需求。例如，如果來賓機器已配置 16 GB 的記憶體，則來賓作業系統磁碟需要的最小磁碟空間是 31 GB。
    
    此外，來賓虛擬機器可能無法直接與安裝於主機機器的光纖通道或 SCSI 主機匯流排介面卡 (HBA) 通訊。在此情況下，您必須在主機機器的作業系統中設定介面卡，並將邏輯單元編號 (LUN) 以虛擬磁碟或傳遞磁碟呈現給來賓虛擬機器。

  - 唯一可透過 Azure 計算資源將電子郵件傳送給外部網域的支援方法是透過 SMTP 轉送 (又名 SMTP 智慧主機)。Azure 計算資源會將電子郵件傳送給 SMTP 轉送，然後 SMTP 轉送提供者會將電子郵件傳遞至外部網域。Microsoft Exchange 線上保護是一個 SMTP 轉送的提供者，但也有許多協力廠商提供者。如需詳細資訊，請參閱 Microsoft Azure 支援小組部落格文章[將電子郵件從 Azure 計算資源傳送至外部網域](https://go.microsoft.com/fwlink/p/?linkid=799723)。

硬體虛擬的需求

## 主機機器儲存需求

以下為每部主機機器的最小磁碟空間需求：

  - 部分硬體虛擬應用程式中的主機機器可能需要作業系統和其元件的儲存空間。例如，執行具有 Hyper-V 的 Windows Server 2008 R2 時，將需要至少 10 GB 才能符合 Windows Server 2008 的需求。如需詳細資訊，請參閱 [Windows Server 2008 R2 系統需求](http://go.microsoft.com/fwlink/p/?linkid=125378)。還需要有額外的儲存空間才能支援作業系統的分頁檔、管理軟體和損毀修復 (傾印) 檔案。

  - 部分 Hypervisor 會在主機機器上維護每部來賓虛擬機器獨有的檔案。例如，在 Hyper-V 環境中，會為每部來賓機器建立並維護暫存記憶體儲存檔案 (BIN 檔案)。每個 BIN 檔案的大小都會等於配置給來賓機器的記憶體數量。此外，也會在主機機器上建立和維護每部來賓機器的其他檔案。

  - 如果您的主機機器執行的是 Windows Server 2012 Hyper-V 或 Hyper-V 2012，而且您正在設定以主機為基礎的容錯移轉叢集，且會讓該叢集將 Exchange 信箱伺服器裝載於資料庫可用性群組中，我們建議您遵循 Microsoft 知識庫文章 2872325 [Hyper-V 中的來賓叢集節點可能無法建立或加入](http://support.microsoft.com/kb/2872325)中所載的指引。

硬體虛擬的需求

## Exchange 儲存需求

連接至虛擬 Exchange 伺服器的儲存需求如下：

  - 每部 Exchange 來賓機器都必須在主機機器的固定磁碟上獲足夠的儲存空間配置，以在該固定磁碟上容納來賓的作業系統、任何使用中暫存記憶體儲存檔，以及裝載於主機機器上的相關虛擬機器檔案。此外，在每部 Exchange 來賓機器中，您也必須配置足夠的儲存空間供郵件佇列使用，以及足夠的儲存供 Mailbox Server 上的資料庫和記錄檔使用。

  - Exchange 來賓機器用於儲存 Exchange 資料 (例如信箱資料庫及傳輸佇列) 的儲存裝置可以是固定大小的虛擬儲存裝置 (例如 Hyper-V 環境中的固定虛擬硬碟 (VHD 或 VHDX))、透過 Hyper-V 使用 VHDX 檔案時的動態虛擬儲存裝置、SCSI 傳遞儲存裝置或 Internet SCSI (iSCSI) 儲存裝置。傳遞儲存裝置是在主機等級上設定且專用於一部來賓機器的儲存裝置。Exchange 來賓機器用於儲存 Exchange 資料的所有儲存裝置必須是區塊層級的儲存裝置，因為 Exchange 2013 不支援使用網路連接儲存裝置 (NAS) 磁碟區，除了本主題稍後描述的 SMB 3.0 案例之外。此外，系統並不支援透過 Hypervisor 向來賓顯示作為區塊層級儲存的 NAS 儲存。

  - 若來賓機器在 Windows Server 2012 Hyper-V (或更新版本的 Hyper-V) 上執行，固定或動態虛擬磁碟可能會儲存在由區塊層級儲存裝置所支援的 SMB 3.0 檔案中。唯一支援使用 SMB 3.0 檔案共用的情形是用於儲存固定或動態虛擬磁碟。這種檔案共用無法用於直接儲存 Exchange 資料。使用 SMB 3.0 檔案共用來儲存固定或動態虛擬磁碟 時，支援檔案共用的儲存裝置應設定為高可用性，以確保 Exchange 服務的最佳可用性。

  - Exchange 使用的儲存應該裝載於磁碟轉軸中，而這些磁碟轉軸與主控來賓虛擬機器作業系統的儲存是分開的。

  - 支援在 Exchange 來賓虛擬機器內設定 iSCSI 儲存使用 iSCSI 啟動器。不過，如果虛擬機器內部的網路堆疊功能不完整 (例如，並非所有虛擬網路堆疊都支援 Jumbo 框架)，則在此組態中效能會降低。

硬體虛擬的需求

## Exchange 記憶體需求和建議

與相同 Hypervisor 所管理之其他來賓機器的需要相較之下，某些 Hypervisor 能夠根據在特定來賓機器中觀察到的記憶體使用量，超訂閱或動態調整該來賓機器可用的記憶體數量。這項技術對於短暫需要記憶體，隨後即釋放供其他用途的工作負載來說相當合理。不過，對於設計為持續使用記憶體的工作負載而言，則不盡合理。Exchange 就像許多具有效能最佳化功能的伺服器應用程式一樣，需要在記憶體中快取資料，如果未能完全控制配置給執行所在之實體或虛擬機器的記憶體，就容易發生系統效能低下與用戶端體驗難以接受的情形。因此，Exchange 不支援使用動態記憶體功能。

硬體虛擬的需求

## Exchange 的主機型容錯移轉叢集和遷移

有關 Exchange 2013 DAG 的主機型容錯移轉叢集和遷移技術，以下為部分常見問題的答案。

  - **Microsoft 是否支援協力廠商遷移技術？**
    
    由於這些技術並非伺服器虛擬化驗證方案 (SVVP) 的一部分，因此 Microsoft 無法針對搭配 Exchange 使用這些技術整合協力廠商 Hypervisor 產品提出支援聲明。SVVP 的範圍包括 Microsoft 對協力廠商 Hypervisor 的其他方面支援。您必須確定您的 Hypervisor 廠商針對結合其遷移和叢集技術提供 Exchange 技援。若您的 Hypervisor 廠商能就 Exchange 提供其遷移技術支援，Microsoft 同樣能就其遷移技術提供 Exchange 支援。

  - **Microsoft 如何定義主機型容錯移轉叢集？**
    
    主機型容錯移轉叢集意指任何能提供自動對主機層級容錯作出反應，並在替代伺服器上啟動受影響的虛擬機器之能力。倘若在一個發生錯誤的案例中，在替代的主機上以冷開機啟動虛擬機器時，則支援使用此技術。此技術有助於確保虛擬機器不會自保留於磁碟中的儲存狀態啟動，因為這對其他的 DAG 成員而言，將顯得較為過時。

  - **Microsoft 指的遷移支援是什麼？**
    
    遷移技術指的是任何能允許有計劃地將虛擬機器從一台主機機器移動到另一台主機機器的技術。此移動作業也可能會自動執行，作為資源負載平衡的一部分，不過，這與系統中是否發生故障無關。只要虛擬機器不是自保留於磁碟中的儲存狀態啟動，遷移作業均可獲得支援。這表示，可在未察覺停機時間的情況下透過網路傳輸狀態和虛擬機器記憶體移動虛擬機器的技術，均可用於 Exchange。協力廠商 Hypervisor 廠商必須提供對遷移技術的支援，Microsoft 則在 Exchange 用於此組態時對其提供支援。

硬體虛擬的需求

