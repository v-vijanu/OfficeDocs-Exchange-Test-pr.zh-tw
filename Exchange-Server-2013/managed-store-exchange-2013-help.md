---
title: '管理的儲存區: Exchange 2013 Help'
TOCTitle: 管理的儲存區
ms:assetid: efdaf80b-335c-491c-8eb5-1fafd297e8a2
ms:mtpsurl: https://technet.microsoft.com/zh-tw/library/Dn792020(v=EXCHG.150)
ms:contentKeyID: 62607056
ms.date: 05/21/2018
mtps_version: v=EXCHG.150
ms.translationtype: MT
---

# 管理的儲存區

 

_**適用版本：**Exchange Server 2013_

_**上次修改主題的時間：**2014-07-14_

所有舊版的 Exchange Server 上，從 Exchange Server 2010、 Exchange Server 4.0 有執行資訊儲存庫程序 (Store.exe) 之單一執行個體上都支援 Mailbox server role。此單一的存放區執行個體架設在伺服器上的所有資料庫 ︰ active、 被動、 延遲、 及復原。在舊版的 Exchange 架構，有一點，若有的話，隔離不同信箱伺服器上裝載的資料庫之間。單一信箱資料庫問題可能會造成負面的影響所有其他資料庫，而且當機次數所產生的信箱損毀可能會影響的資料庫架設在該伺服器的所有使用者的服務。

與舊版 Exchange 中的單一存放區執行個體的另一項挑戰是可延伸儲存引擎 (ESE) 的比例，調整適合用來 8-12 處理器核心，但超出可、 跨處理器通訊及快取同步處理問題導致負數的小數位數。指定的今天的太多較大的伺服器，與 16 + 核心系統提供，這表示加諸的 ESE 管理 8-12 個核心的親和性及其他核心用於非存放區處理序 （例如助理、 Search Foundation、 受管理的可用性、 等） 的系統管理挑戰。此外，舊的架構受限制的存放區處理序的向外延展。

Store.exe 程序有許多演變為 Exchange 伺服器本身演變，years 整個但為單一程序，最終它的擴展性有限，且其代表單一失敗點。因為這些限制，而 Store.exe 會變成實際上台 Exchange 2013 並取代為受管理存放區。

## 管理的儲存區

受管理存放區為名稱的資訊儲存庫 （亦即存放區） 會處理在 Exchange Server 2013。受管理存放區使用提供存放區處理序隔離及更快的資料庫容錯移轉控制器/工作者處理序模型。受管理存放區也包含新的靜態資料庫快取機制，取代了舊版 Exchange Server 中的動態緩衝區演算法。使用受管理存放區的多程序模型，只有 （在此例中 Microsoft.Exchange.Store.Service.exe 亦即 MSExchangeIS）、 單一存放區服務控制站程序和一個工作者處理序 （在此例中是 Microsoft.Exchange.Store.Worker.exe） 的每個裝載資料庫。 當裝載資料庫時，新的工作者處理序具現化服務只有該資料庫。會卸載資料庫，當終止工作者處理序該資料庫。

例如，如果您有 40 伺服器上裝載的資料庫，將會有 41 受管理儲存區，另一個適用於每個資料庫和一個用於存放區服務處理序控制器執行的程序。

Store 服務處理序控制器極細和非常可靠，但如果它故障了或終止前，所有其工作者處理序死 （他們會偵測 service 控制器程序已消失及結束）。存放區處理序控制器監視伺服器上的所有儲存區工作者處理序的狀況。強制或意外終止 Microsoft.Exchange.Store.Service.exe 會導致所有使用中資料庫副本立即容錯移轉。Microsoft Exchange 複寫服務 (MSExchangeRepl.exe) 與 Active Manager 也變得更密切整合受管理存放區。Controller 處理、 工作者處理序及複寫服務可以搭配使用以提供更大的可用性及可靠性：

  - Microsoft Exchange 複寫服務程序 (MSExchangeRepl.exe)
    
      - 負責發出裝載及卸載至存放區的作業
    
      - 會在儲存或資料庫失敗報告的存放區、 可延伸儲存引擎 (ESE) 及受管理的可用性回應程式復原動作
    
      - 偵測非預期的資料庫失敗
    
      - 提供的管理工作的系統管理介面

  - Store 服務程序/控制器 (Microsoft.Exchange.Store.Service.exe)
    
      - 管理根據從複寫服務接收到的裝載及卸載作業每個工作者處理序存留期
    
      - 處理傳入要求的 Windows 服務控制管理員
    
      - 記錄失敗的項目 （例如當機或未預期的結束） 偵測到的存放區工作者處理序問題時
    
      - 終止回應容錯移轉事件中的儲存區工作者處理序

  - 儲存工作者處理序 (Microsoft.Exchange.Store.Worker.exe)
    
      - 負責在資料庫上執行的信箱 RPC 作業
    
      - RPC 端點的執行個體內工作者處理序是資料庫的 GUID
    
      - 提供資料庫快取的資料庫

## 靜態資料庫快取演算法

動態緩衝區配置的最早出現在 \[Exchange Server 5.5 及也使用過的資訊儲存庫稱為資料庫快取演算法 Exchange 2000 Server、 Exchange Server 2003、 Exchange Server 2007 及 Exchange Server 2010、 也是消失從 Exchange 2013。Exchange 2013 使用十分簡單且直接的演算法判斷資料庫快取。受管理存放區不再動態重新配置資料庫容錯移轉發生時，可大幅簡化內部快取管理之間的快取。而配置給每個資料庫快取 （例如每個的存放區工作者處理序） 的記憶體為基礎的本機資料庫複本數目和*MaximumActiveDatabases*、 值如果設定。如果*MaximumActiveDatabases*的值大於目前的資料庫副本的數目、 快取計算根據資料庫副本的數目。

Exchange 2013 所使用的靜態演算法會根據實體 RAM 的每個儲存區工作者處理序的 ESE 快取的配置記憶體。這被稱為資料庫的*最大快取目標*。25%的總伺服器記憶體配置給 ESE 快取。這被稱為*伺服器快取大小目標*。

<table>
<thead>
<tr class="header">
<th><img src="images/Bb124558.note(EXCHG.150).gif" title="注意事項" alt="注意事項" />注意事項：</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>伺服器快取大小 Target 與因此配置給之儲存區的 ESE 快取的記憶體數量可以覆寫 （設定的值是跨所有存放區處理序配置頁數 32KB） 的 Active Directory 中使用<em>InformationStore</em>物件的<em>msExchESEParamCacheSizeMax</em>屬性。</td>
</tr>
</tbody>
</table>


此快取靜態量配置給主動與被動副本。只有當服務作用中資料庫副本時，存放區的工作者處理序會配置最大快取目標。被動資料庫副本的配置的最大快取目標的 20%。其餘部分是由 「 儲存 」、 保留和如果將資料庫從被動轉換成作用中的工作者處理序配置。

最大快取目標是只會在 Store 啟動所計算。因此，如果您新增或移除資料庫或資料庫副本，您必須重新啟動存放區控制器服務 (MSExchangeIS) 使跟著調整快取。如果服務不重新啟動，請依新建立的資料庫將會有較小的快取大小目標比在服務啟動之前建立的資料庫。此事件，在資料庫快取大小目標的總和會可能超過伺服器快取大小目標重新 MSExchangeIS。

## 範例資料庫快取計算

以下範例資料庫的快取的信箱伺服器的記憶體及資料庫設定為基礎的計算。

**範例 1**

在此範例中的信箱伺服器有 48 GB 的記憶體，與它裝載這兩個使用中資料庫和兩個被動資料庫。此外， *MaximumActiveDatabases*參數未設定。在此組態中，資料庫快取為 3 GB 的每個使用中資料庫副本工作者處理序和 0.6 GB 的每個被動資料庫副本工作者處理序。以下是如何所獲得這些值。

若要取得伺服器快取大小目標，乘以 25%中的記憶體數量：

48 GB X 25%= 12 GB

若要取得資料庫最大快取目標、 除以總數主動和被動資料庫中的伺服器快取大小目標：

12 GB / 4 資料庫 = 3 GB

若要決定用於被動資料庫副本的記憶體數量，乘以 20%中的資料庫最大快取目標：

3 GB X 20%= 0.6 GB

超出記憶體指派給伺服器快取大小目標 12 GB，7.2 GB 會使用資料庫工作者處理序，而且會由兩個被動資料庫副本的資訊儲存庫保留 4.8 GB，以防會變成作用中副本。在此事件時將會使用其最大快取的目標 3 GB。

**範例 2**

在此範例中的信箱伺服器也有 48 GB 記憶體和主機的兩個使用中資料庫和兩個被動資料庫 ；不過， *MaximumActiveDatabases*參數會設定值為 2。在此組態中，資料庫快取的數字是 5 GB 的每個使用中資料庫副本工作者處理序和 0.2 GB 的每個被動資料庫副本工作者處理序。以下是如何所獲得這些值。

若要取得伺服器快取大小目標，乘以 25%中的記憶體數量：

48 GB X 25%= 12 GB

若要取得資料庫最大快取目標，劃分為伺服器快取大小目標的主動資料庫總數加上乘以 20%的被動資料庫總數：

12 GB / (2A + (2 P X 20 %)) = 5 GB

若要決定用於被動資料庫副本的記憶體數量，乘以 20%中的資料庫最大快取目標：

5 GB X 20%= 1 GB

超出記憶體指派給伺服器快取大小目標 12 GB，12 GB 會使用資料庫工作者處理序，而且沒有記憶體會保留由兩個被動資料庫副本的資訊儲存庫因為無法會變成在此組態中的主動副本 （因為*MaximumActiveDatabases*已設定的值為 2、 已經有 2 使用中資料庫副本的伺服器上）。

